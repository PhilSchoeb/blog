---
layout: post
title: Milestone 2
---

## Suivi des expériences

## Ingénierie des caractéristiques

### Question 1 :

### Question 2 :

### Question 3 :

## Modèles de base

### Question 1 :

### Question 2 :

### Question 3 :

### Question 4 :

## Ingénierie des caractéristiques II
### Liste des caractéristiques créées

| **Nom de la colonne**               | **Description lisible par un humain**                                                                                             |
|-------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| **time_in_period_seconds**          | Temps écoulé dans la période actuelle, converti en secondes à partir du format `MM:SS`.                                           |
| **game_seconds**                    | Nombre total de secondes écoulées dans le jeu, calculé comme : `(period_number - 1) * 1200 + time_in_period_seconds`.             |
| **last_event_type**                 | Type de l’événement précédent (par exemple, `shot-on-goal`, `blocked-shot`, `goal`, etc.).                                        |
| **last_x**                          | Coordonnée X de l’événement précédent (sur le terrain).                                                                           |
| **last_y**                          | Coordonnée Y de l’événement précédent (sur le terrain).                                                                           |
| **time_since_last_event**           | Temps écoulé (en secondes) depuis l’événement précédent.                                                                          |
| **distance_from_last_event**        | Distance entre les coordonnées (X, Y) de l’événement précédent et celles de l’événement actuel (en unités du terrain).            |
| **is_rebound**                      | Indicateur booléen : `True` si l’événement précédent était un tir (`shot-on-goal`, `missed-shot`, `blocked-shot`), sinon `False`. |
| **speed**                           | Vitesse calculée comme : `distance_from_last_event / time_since_last_event`. Si le temps écoulé est 0, vitesse = 0.               |
| **last_angle**                      | Angle du tir précédent (en degrés) par rapport au filet.                                                                          |
| **absolute_angle_change**           | Changement d’angle absolu entre le tir actuel et le tir précédent, calculé comme : `abs(goal_angle) + abs(last_angle)`.           |
| **power_play_time_elapsed (BONUS)** | Temps écoulé (en secondes) depuis le début de l’avantage numérique (jeu de puissance). Réinitialisé à 0 en fin de pénalité.       |
| **shooting_team_skaters (BONUS)**   | Nombre de patineurs sur glace pour l'équipe effectuant le tir.                                                                    |
| **opposing_team_skaters (BONUS)**   | Nombre de patineurs sur glace pour l'équipe adverse.                                                                              |


---

Lien vers l'expérience qui stocke l'artefact DataFrame filtré pour le jeu spécifié :

https://wandb.ai/IFT6758-2024-A05/ift6758-milestone-2/artifacts/dataset/wpg_v_wsh_2017021065/v1/files

## Modèles avancés

### Question 1 :

Voici les 4 figures demandées :

<img src="/images/roc_basic_xgboost.png" alt="ROC Curve" />
<img src="/images/goal_rate_vs_proba_basic_xgboost.png" alt="Goal Rate vs Probability" />
<img src="/images/cumul_goal_prop_vs_proba_basic_xgboost.png" alt="Cumulative Goal Propensity vs Probability" />
<img src="/images/calibration_curve_basic_xgboost.png" alt="Calibration Curve" />

La configuration de l'ensemble d'entrainement et de validation s'est faite de même manière qu'à la partie 3 (modèles simples). C'est-à-dire une séparation 80-20 aléatoire (même seed pour les deux parties).

Comparaison des résultats à la régression logistique.

### Question 2 :

Premièrement, voici les hyperparamètres que nous avons optimisés ainsi que leur différentes options testées :

Booster = "gbtree" ou "dart"

eta = 0.1, 0.3, 0.5 ou 0.8

gamma = 0, 10 ou 100

max_depth = 4, 6, 8 ou 12

Notre méthode d'optimisation a été d'effectuer une recherche par grille avec une validation non croisée. Nous avons fait ce choix pour pouvoir tester toutes les 96 configurations possibles sans que le temps de computation soit trop élevé. Il est important de noter que nous avons tenté d'optimiser l'AUC (area under curve) par la sélection des hyperparamètres car nous nous intéressons uniquement aux probabilités qu'il y ait un but.

Regardons maintenant l'influence de chaque hyperparamètre, en supposant faussement qu'ils sont indépendants les uns par rapport aux autres, sur l'accuracy et l'AUC moyenne :

<img src="/images/booster.png" alt="Booster config" />
<img src="/images/eta.png" alt="eta config" />
<img src="/images/gamma.png" alt="gamma config" />
<img src="/images/max_depth.png" alt="max_depth config" />

On peut voir que le choix de booster ne semble pas avoir d'effet, mais les autres hyperparamètres peuvent être optimisés. En prenant la configuration qui maximise l'AUC, nous avons sélectionné la configuration suivante: 

Booster = "gbtree", eta = 0.3, gamma = 0 et max_depth = 8. 

Voici une visualisation pour s'en convaincre :

<img src="/images/roc_curve_hp.png" alt="Roc curve for all different hyperparameters configuration" />

Voici maintenant les quatres figures demandées pour notre modèle sélectionné :

<img src="/images/roc_best_xgboost_gbtree_0.3_0_8.png" alt="ROC Curve" />
<img src="/images/goal_rate_vs_proba_best_xgboost_gbtree_0.3_0_8.png" alt="Goal Rate vs Probability" />
<img src="/images/cumul_goal_prop_vs_proba_best_xgboost_gbtree_0.3_0_8.png" alt="Cumulative Goal Propensity vs Probability" />
<img src="/images/calibration_curve_best_xgboost_gbtree_0.3_0_8.png" alt="Calibration Curve" />

En comparant ces figures à celles obtenues à la partie 5.1, on voit que la courbe ROC a la même forme mais son aire sous la courbe est supérieure maintenant. Par rapport, à la figure du goal_rate en fonction du centile de la probabilité prédite, on constate qu'une augmentation du centile a maintenant plus de chance qu'avant d'augmenter le taux de but et aussi que le taux de but augmente quasi exponentielle à partir du 80e centile. On observe aussi que la valeur maximale de goal_rate atteinte est deux fois plus grande. Passons à la figure du pourcentage cumulatif de buts en fonction du centile de la probabilité prédite. Ici, on voit que la courbe est plus prononcée et cela implique qu'il y a beaucoup moins de buts parmi les points prédits à probabilité basse et inversement, il y a plus de points prédits à haute probabilité qui sont des buts. Finalement, on observe la courbe de calibration et on voit directement que les probabilités prédites sont plus élevées. Nos deux courbes suivent assez bien la droite optimale et les deux prédisent des probabilités un peu trop basses pour les plus grandes probabilités prédites.

Pour finir, voici le lien de l'expérience sur Wandb :

https://wandb.ai/IFT6758-2024-A05/best%20xgboost 

### Question 3 :

## Expérimentation de modèles

### Question 1 :

### Question 2 :

## Évaluation sur l'ensemble de test

### Question 1 :

### Question 2 :

